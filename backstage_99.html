<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sawkoff Studio - Admin</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; justify-content: center; padding: 20px; }
        .admin-panel { background: #111; padding: 30px; border-radius: 15px; border: 1px solid #ff0000; width: 100%; max-width: 400px; text-align: center; }
        h2 { color: #ff0000; letter-spacing: 2px; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #333; color: #fff; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: #ff0000; border: none; color: #fff; font-weight: bold; border-radius: 5px; cursor: pointer; margin-top: 20px; }
        button:disabled { background: #555; }
        #status { margin-top: 15px; font-size: 14px; }
    </style>
</head>
<body>

<div class="admin-panel">
    <h2>STUDIO ACTIVE</h2>
    <input type="password" id="ghToken" placeholder="–í—Å—Ç–∞–≤ —Å–≤—ñ–π GitHub Token">
    <input type="text" id="trackTitle" placeholder="–ù–∞–∑–≤–∞ –ø—ñ—Å–Ω—ñ">
    <input type="text" id="ytId" placeholder="YouTube ID –∞–±–æ –Ω–∞–∑–≤–∞ .mp3">
    <select id="emoji">
        <option value="üè†">–î–æ–º (üè†)</option>
        <option value="üî•">–í–æ–≥–æ–Ω—å (üî•)</option>
        <option value="üéµ">–ù–æ—Ç–∞ (üéµ)</option>
        <option value="üíî">–°–µ—Ä—Ü–µ (üíî)</option>
    </select>
    <button id="pubBtn" onclick="updateSite()">–û–ü–£–ë–õ–Ü–ö–£–í–ê–¢–ò –¢–†–ï–ö</button>
    <p id="status"></p>
</div>

<script>
async function updateSite() {
    const token = document.getElementById('ghToken').value.trim();
    const title = document.getElementById('trackTitle').value;
    const rawId = document.getElementById('ytId').value.trim();
    const emoji = document.getElementById('emoji').value;
    const btn = document.getElementById('pubBtn');
    const status = document.getElementById('status');

    // –õ–æ–≥—ñ–∫–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç—É (MP3 —á–∏ YouTube)
    let cleanId = rawId;
    let isMp3 = rawId.toLowerCase().endsWith('.mp3');

    if (!isMp3) {
        if (rawId.includes('v=')) cleanId = rawId.split('v=')[1].split('&')[0];
        else if (rawId.includes('youtu.be/')) cleanId = rawId.split('youtu.be/')[1].split('?')[0];
        cleanId = cleanId.split('?')[0];
    }

    if(!token || !title || !cleanId) return alert("–ó–∞–ø–æ–≤–Ω–∏ –≤—Å—ñ –ø–æ–ª—è!");

    btn.disabled = true;
    status.innerText = "–ó'—î–¥–Ω—É—é—Å—å –∑ GitHub...";

    const REPO = "sawafran/my-web"; 

    try {
        const fileUrl = `https://api.github.com/repos/${REPO}/contents/premium.html`;
        const res = await fetch(fileUrl, {
            headers: { 'Authorization': `token ${token}` }
        });
        
        if (!res.ok) throw new Error("–§–∞–π–ª premium.html –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!");
        const data = await res.json();
        
        const bytes = Uint8Array.from(atob(data.content.replace(/\s/g, '')), c => c.charCodeAt(0));
        const content = new TextDecoder('utf-8').decode(bytes);

        // –§–æ—Ä–º—É—î–º–æ –ø–ª–µ—î—Ä –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É —Ñ–∞–π–ª—É
        let playerHtml = '';
        if (isMp3) {
            playerHtml = `<audio controls style="width: 100%; margin-top: 10px;">
                <source src="https://raw.githubusercontent.com/${REPO}/main/${cleanId}" type="audio/mpeg">
                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∞—É–¥—ñ–æ.
            </audio>`;
        } else {
            playerHtml = `<div class="player-wrapper">
                <iframe src="https://www.youtube.com/embed/${cleanId}?modestbranding=1&rel=0" allowfullscreen></iframe>
            </div>`;
        }

        const newCard = `
    <div class="track-card">
        <div class="track-info">
            <h3>${title} ${emoji}</h3>
            <p>SA–®KOFF ‚Ä¢ 2026</p>
        </div>
        ${playerHtml}
    </div>`;

        const marker = '<div id="music-list"></div>';
        if(!content.includes(marker)) throw new Error("–ú–∞—Ä–∫–µ—Ä music-list –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!");
        
        const updatedContent = content.replace(marker, marker + newCard);
        const utf8Bytes = new TextEncoder().encode(updatedContent);
        const base64Content = btoa(String.fromCharCode(...utf8Bytes));

        const updateRes = await fetch(fileUrl, {
            method: 'PUT',
            headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({
                message: `üéµ –ù–æ–≤–∏–π —Ä–µ–ª—ñ–∑: ${title}`,
                content: base64Content,
                sha: data.sha
            })
        });

        if(updateRes.ok) {
            status.style.color = "#0f0";
            status.innerText = "–£–°–ü–Ü–•! –¢—Ä–µ–∫ –¥–æ–¥–∞–Ω–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É.";
        } else {
            const errJson = await updateRes.json();
            throw new Error(errJson.message);
        }

    } catch (err) {
        status.style.color = "#f00";
        status.innerText = "–ü–æ–º–∏–ª–∫–∞: " + err.message;
    } finally {
        btn.disabled = false;
    }
}
</script>
</body>
</html>
