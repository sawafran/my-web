<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SA–®KOFF | Studio Admin</title>
    <style>
        body { background: #050505; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .box { background: #111; border: 1px solid #ff0000; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; box-shadow: 0 0 30px rgba(255,0,0,0.2); }
        h2 { color: #ff0000; margin-top: 0; text-transform: uppercase; letter-spacing: 2px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 8px; box-sizing: border-box; }
        input:focus { border-color: #ff0000; outline: none; }
        button { width: 100%; padding: 15px; background: #ff0000; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        button:hover { background: #cc0000; transform: scale(1.02); }
        button:disabled { background: #444; cursor: not-allowed; }
        #adminPanel { display: none; }
        #status { margin-top: 15px; font-size: 13px; color: #888; }
    </style>
</head>
<body>

<div id="loginForm" class="box">
    <h2>Access Control</h2>
    <p style="font-size: 14px; color: #666;">–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å –≤—ñ–¥ —Å—Ç—É–¥—ñ—ó:</p>
    <input type="password" id="passInput" placeholder="Password...">
    <button onclick="checkPass()">–£–í–Ü–ô–¢–ò</button>
</div>

<div id="adminPanel" class="box">
    <h2>Studio Active</h2>
    <input type="password" id="ghToken" placeholder="GitHub Personal Token">
    <div style="border-bottom: 1px solid #222; margin: 15px 0;"></div>
    <input type="text" id="trackTitle" placeholder="–ù–∞–∑–≤–∞ –ø—ñ—Å–Ω—ñ (–Ω–∞–ø—Ä. –î–û–î–û–ú–£)">
    <input type="text" id="ytId" placeholder="ID –≤—ñ–¥–µ–æ (–Ω–∞–ø—Ä. RafOH_0WsxY)">
    <input type="text" id="emoji" placeholder="–ï–º–æ–¥–∑—ñ (–Ω–∞–ø—Ä. üî•)" value="üéµ">
    
    <button id="pubBtn" onclick="updateSite()">–û–ü–£–ë–õ–Ü–ö–£–í–ê–¢–ò –¢–†–ï–ö</button>
    <div id="status"></div>
</div>

<script>
    // –í–°–¢–ê–í –°–í–Ü–ô –ü–ê–†–û–õ–¨ –¢–£–¢
    const ACCESS_PASSWORD = "1707viki"; 
    // –í–°–¢–ê–í –°–í–Ü–ô –†–ï–ü–û–ó–ò–¢–û–†–Ü–ô –¢–£–¢ (username/repository)
    const REPO_PATH = "sawafran/my-web.github.io"; 

    function checkPass() {
        if(document.getElementById('passInput').value === ACCESS_PASSWORD) {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
        } else {
            alert("–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É!");
        }
    }

 async function updateSite() {
    const token = document.getElementById('ghToken').value.trim();
    const title = document.getElementById('trackTitle').value;
    const id = document.getElementById('ytId').value;
    const emoji = document.getElementById('emoji').value;
    const btn = document.getElementById('pubBtn');
    const status = document.getElementById('status');

    if(!token || !title || !id) return alert("–ó–∞–ø–æ–≤–Ω–∏ Token, –ù–∞–∑–≤—É —Ç–∞ ID!");

    btn.disabled = true;
    status.innerText = "–ó'—î–¥–Ω—É—é—Å—å –∑ GitHub...";

    try {
        const fileUrl = `https://api.github.com/repos/${REPO_PATH}/contents/premium.html`;
        const res = await fetch(fileUrl, {
            headers: { 'Authorization': `token ${token}` }
        });
        
        if (!res.ok) throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ñ–∞–π–ª. –ü–µ—Ä–µ–≤—ñ—Ä Token —Ç–∞ —à–ª—è—Ö –¥–æ —Ä–µ–ø–æ.");
        
        const data = await res.json();
        
        // –ü–†–ê–í–ò–õ–¨–ù–ï –†–û–ó–®–ò–§–†–£–í–ê–ù–ù–Ø –î–õ–Ø –£–ö–†–ê–á–ù–°–¨–ö–û–á –ú–û–í–ò
        const content = decodeURIComponent(atob(data.content).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));

        const newCard = `
    <div class="track-card">
        <div class="track-info">
            <h3>${title} ${emoji}</h3>
            <p>SA–®KOFF ‚Ä¢ 2026</p>
        </div>
        <div class="player-wrapper">
            <iframe src="https://www.youtube.com/embed/${id}?modestbranding=1&rel=0" allowfullscreen></iframe>
        </div>
    </div>`;

        const marker = '<div id="music-list"></div>';
        if(!content.includes(marker)) throw new Error("–ú–∞—Ä–∫–µ—Ä id='music-list' –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ premium.html!");
        
        const updatedContent = content.replace(marker, marker + newCard);

        // –ü–†–ê–í–ò–õ–¨–ù–ï –ó–ê–®–ò–§–†–£–í–ê–ù–ù–Ø –ù–ê–ó–ê–î –£ BASE64
        const base64Content = btoa(encodeURIComponent(updatedContent).replace(/%([0-9A-F]{2})/g,
            function toSolidBytes(match, p1) {
                return String.fromCharCode('0x' + p1);
        }));

        const updateRes = await fetch(fileUrl, {
            method: 'PUT',
            headers: { 
                'Authorization': `token ${token}`,
                'Content-Type': 'application/json' 
            },
            body: JSON.stringify({
                message: `New Release: ${title}`,
                content: base64Content,
                sha: data.sha
            })
        });

        if(updateRes.ok) {
            status.style.color = "#0f0";
            status.innerText = "–£–°–ü–Ü–•! –ü—ñ—Å–Ω—è –≤ –µ—Ñ—ñ—Ä—ñ.";
            document.getElementById('trackTitle').value = "";
            document.getElementById('ytId').value = "";
        } else {
            const errorInfo = await updateRes.json();
            throw new Error(errorInfo.message || "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ.");
        }

    } catch (err) {
        status.style.color = "#f00";
        status.innerText = "Error: " + err.message;
        console.error(err);
    } finally {
        btn.disabled = false;
    }
}
</script>
</body>
</html>
