<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SA–®KOFF | Studio Admin</title>
    <style>
        body { background: #050505; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .box { background: #111; border: 1px solid #ff0000; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; box-shadow: 0 0 30px rgba(255,0,0,0.2); }
        h2 { color: #ff0000; margin-top: 0; text-transform: uppercase; letter-spacing: 2px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 8px; box-sizing: border-box; }
        input:focus { border-color: #ff0000; outline: none; }
        button { width: 100%; padding: 15px; background: #ff0000; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        button:hover { background: #cc0000; transform: scale(1.02); }
        button:disabled { background: #444; cursor: not-allowed; }
        #adminPanel { display: none; }
        #status { margin-top: 15px; font-size: 13px; color: #888; }
    </style>
</head>
<body>

<div id="loginForm" class="box">
    <h2>Access Control</h2>
    <p style="font-size: 14px; color: #666;">–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å –≤—ñ–¥ —Å—Ç—É–¥—ñ—ó:</p>
    <input type="password" id="passInput" placeholder="Password...">
    <button onclick="checkPass()">–£–í–Ü–ô–¢–ò</button>
</div>

<div id="adminPanel" class="box">
    <h2>Studio Active</h2>
    <input type="password" id="ghToken" placeholder="GitHub Personal Token">
    <div style="border-bottom: 1px solid #222; margin: 15px 0;"></div>
    <input type="text" id="trackTitle" placeholder="–ù–∞–∑–≤–∞ –ø—ñ—Å–Ω—ñ (–Ω–∞–ø—Ä. –î–û–î–û–ú–£)">
    <input type="text" id="ytId" placeholder="ID –≤—ñ–¥–µ–æ (–Ω–∞–ø—Ä. RafOH_0WsxY)">
    <input type="text" id="emoji" placeholder="–ï–º–æ–¥–∑—ñ (–Ω–∞–ø—Ä. üî•)" value="üéµ">
    
    <button id="pubBtn" onclick="updateSite()">–û–ü–£–ë–õ–Ü–ö–£–í–ê–¢–ò –¢–†–ï–ö</button>
    <div id="status"></div>
</div>

<script>
    // –í–°–¢–ê–í –°–í–Ü–ô –ü–ê–†–û–õ–¨ –¢–£–¢
    const ACCESS_PASSWORD = "1707viki"; 
    // –í–°–¢–ê–í –°–í–Ü–ô –†–ï–ü–û–ó–ò–¢–û–†–Ü–ô –¢–£–¢ (username/repository)
    const REPO_PATH = "sawafran/my-web"; 

    function checkPass() {
        if(document.getElementById('passInput').value === ACCESS_PASSWORD) {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
        } else {
            alert("–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É!");
        }
    }

async function updateSite() {
    const token = document.getElementById('ghToken').value.trim();
    const title = document.getElementById('trackTitle').value;
    const id = document.getElementById('ytId').value;
    const emoji = document.getElementById('emoji').value;
    const btn = document.getElementById('pubBtn');
    const status = document.getElementById('status');

    if(!token || !title || !id) return alert("–ó–∞–ø–æ–≤–Ω–∏ –≤—Å—ñ –ø–æ–ª—è!");

    btn.disabled = true;
    status.innerText = "–ó'—î–¥–Ω—É—é—Å—å –∑ GitHub...";

    // –ü–ï–†–ï–í–Ü–† –¶–ï–ô –†–Ø–î–û–ö –©–ï –†–ê–ó –ü–ï–†–ï–î –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø–ú:
    const REPO = "sawafran/my-web.github.io"; 

    try {
        // –î–æ–¥–∞—î–º–æ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä ?nocache, —â–æ–± –æ–±—ñ–π—Ç–∏ –∫–µ—à
       // –ó–º—ñ–Ω–∏ —Ü–µ–π —Ä—è–¥–æ–∫ —É —Å–≤–æ—ó–π —Ñ—É–Ω–∫—Ü—ñ—ó updateSite:
        const fileUrl = `https://api.github.com/repos/${REPO}/contents/premium.html`;
        
     const res = await fetch(`https://api.github.com/repos/${REPO}/contents/premium.html`, {
    headers: { 'Authorization': `token ${token}` }
});

if (res.status === 404) {
    status.innerText = "–ü–æ–º–∏–ª–∫–∞ 404: GitHub –Ω–µ –±–∞—á–∏—Ç—å —Ñ–∞–π–ª premium.html —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó " + REPO;
    throw new Error("–ü–µ—Ä–µ–≤—ñ—Ä –Ω–∞–∑–≤—É —Ä–µ–ø–æ –∞–±–æ —á–∏ —Ñ–∞–π–ª –Ω–µ –≤ –ø–∞–ø—Ü—ñ!");
}
        
        const data = await res.json();
        const bytes = Uint8Array.from(atob(data.content.replace(/\s/g, '')), c => c.charCodeAt(0));
        const content = new TextDecoder('utf-8').decode(bytes);

        const newCard = `
    <div class="track-card">
        <div class="track-info">
            <h3>${title} ${emoji}</h3>
            <p>SA–®KOFF ‚Ä¢ 2026</p>
        </div>
        <div class="player-wrapper">
            <iframe src="https://www.youtube.com/embed/${id}?modestbranding=1&rel=0" allowfullscreen></iframe>
        </div>
    </div>`;

        const marker = '<div id="music-list"></div>';
        if(!content.includes(marker)) throw new Error("–ú–∞—Ä–∫–µ—Ä id='music-list' –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ premium.html!");
        
        const updatedContent = content.replace(marker, marker + newCard);
        const utf8Bytes = new TextEncoder().encode(updatedContent);
        const base64Content = btoa(String.fromCharCode(...utf8Bytes));

        const updateRes = await fetch(fileUrl.split('?')[0], {
            method: 'PUT',
            headers: { 
                'Authorization': `token ${token}`,
                'Content-Type': 'application/json' 
            },
            body: JSON.stringify({
                message: `üéµ –ù–æ–≤–∏–π —Ç—Ä–µ–∫: ${title}`,
                content: base64Content,
                sha: data.sha,
                branch: "main" // –í–∫–∞–∑—É—î–º–æ –≥—ñ–ª–∫—É —è–≤–Ω–æ
            })
        });

        if(updateRes.ok) {
            status.style.color = "#0f0";
            status.innerText = "–£–°–ü–Ü–•! –ü—ñ—Å–Ω—è –¥–æ–¥–∞–Ω–∞. –û–Ω–æ–≤–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É —á–µ—Ä–µ–∑ —Ö–≤–∏–ª–∏–Ω—É.";
            document.getElementById('trackTitle').value = "";
            document.getElementById('ytId').value = "";
        } else {
            const errJson = await updateRes.json();
            throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–±–µ—Ä–µ–≥—Ç–∏: " + errJson.message);
        }

    } catch (err) {
        status.style.color = "#f00";
        status.innerText = err.message;
        console.error(err);
    } finally {
        btn.disabled = false;
    }
}

</script>
</body>
</html>
